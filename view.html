<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>ZUSCHAUER | v4.1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style> 
        body { background: #050000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; } 
        .active-card { border-left: 8px solid #dc2626; background: linear-gradient(90deg, rgba(220, 38, 38, 0.15) 0%, rgba(0,0,0,0) 100%); }
        footer { position: fixed; bottom: 0; left: 0; width: 100%; py: 2; background: rgba(0,0,0,0.9); border-top: 1px solid rgba(255,255,255,0.05); text-align: center; padding: 10px 0; }
    </style>
</head>
<body class="p-12">
    <div class="max-w-[1600px] mx-auto grid grid-cols-12 gap-12">
        <div class="col-span-7 space-y-6" id="player-list-container"></div>
        <div class="col-span-5 space-y-8">
            <div class="bg-white/5 rounded-[3rem] p-12 text-center relative overflow-hidden border border-white/10 shadow-2xl">
                <div id="status-indicator" class="absolute top-6 right-8 px-4 py-1 rounded-full text-[10px] font-black uppercase bg-red-600">LOBBY</div>
                <div id="round-timer" class="text-9xl font-mono font-black italic tracking-tighter">02:30</div>
            </div>
            <div id="focus-card" class="bg-white/5 rounded-[3rem] p-12 text-center border-2 border-red-600/30 shadow-2xl">
                <div id="active-player-name" class="text-6xl font-black italic mb-8 uppercase tracking-tighter">---</div>
                <div class="inline-block px-12 py-4 bg-red-600 rounded-3xl"><div id="player-timer" class="text-9xl font-mono font-black">30</div></div>
            </div>
            <div id="voting-info" class="hidden bg-blue-900/10 rounded-[2.5rem] p-8 border-2 border-blue-500/50 flex justify-between items-center"><p id="v-status" class="text-blue-400 font-black text-sm uppercase italic">Voting Aktiv</p><div id="vote-timer" class="text-3xl font-mono font-black text-blue-500">60s</div></div>
        </div>
    </div>

    <footer>
        <p class="text-[10px] tracking-[0.5em] font-black text-white/20 uppercase italic">Main Production View — Version 4.1.0</p>
    </footer>

    <script type="module">
        import { db, ref, onValue } from "./firebase-config.js";
        onValue(ref(db), (snap) => {
            const data = snap.val(); if(!data) return;
            const players = data.players || {}; const gs = data.gameState || {};
            const rt = gs.roundTimer || 0; document.getElementById('round-timer').innerText = `${Math.floor(rt/60)}:${(rt%60).toString().padStart(2,'0')}`;
            document.getElementById('player-timer').innerText = gs.playerTimer || 30;
            const stat = document.getElementById('status-indicator'); const vInfo = document.getElementById('voting-info');
            if(gs.votingActive) { stat.innerText = "VOTING"; stat.className = "absolute top-6 right-8 px-4 py-1 rounded-full text-[10px] font-black bg-blue-600 animate-pulse"; vInfo.classList.remove('hidden'); document.getElementById('v-status').innerText = "VOTING LÄUFT"; document.getElementById('vote-timer').innerText = gs.voteTimer + "s"; }
            else if(gs.votingFinished) { stat.innerText = "FERTIG"; stat.className = "absolute top-6 right-8 px-4 py-1 rounded-full text-[10px] font-black bg-blue-900"; vInfo.classList.remove('hidden'); document.getElementById('v-status').innerText = "ALLE GEWÄHLT"; document.getElementById('vote-timer').innerText = ""; }
            else { vInfo.classList.add('hidden'); stat.innerText = gs.active ? "LIVE" : "LOBBY"; stat.className = `absolute top-6 right-8 px-4 py-1 rounded-full text-[10px] font-black ${gs.active ? 'bg-red-600' : 'bg-gray-600'}`; }
            const list = document.getElementById('player-list-container'); list.innerHTML = "";
            for(let id in players) {
                const p = players[id]; if(p.isDran) document.getElementById('active-player-name').innerText = p.name;
                const d = document.createElement('div'); d.className = `bg-white/5 rounded-3xl p-6 flex justify-between items-center border border-white/5 transition-all ${p.isDran ? 'active-card' : 'opacity-40'}`;
                let res = ""; if(gs.showResults) { 
                    const total = Object.keys(data.votes || {}).length; const count = Object.values(data.votes || {}).filter(v => v === id).length; const perc = total > 0 ? Math.round((count/total)*100) : 0; 
                    res = `<div class="flex-1 mx-12"><div class="w-full bg-white/5 h-4 rounded-full overflow-hidden border border-white/5"><div class="bg-blue-500 h-full" style="width: ${perc}%"></div></div><p class="text-blue-400 font-bold text-xl mt-1">${perc}%</p></div>`; 
                }
                d.innerHTML = `<div class="flex items-center gap-6 flex-1 text-white"><span class="text-4xl font-black uppercase italic tracking-tighter">${p.name}</span>${p.jokerUsed ? '' : '<span class="text-yellow-500 text-3xl">⭐</span>'}</div>${res}<div class="text-4xl ml-8">${p.lives > 0 ? "❤️".repeat(p.lives) : "☠️"}</div>`;
                list.appendChild(d);
            }
        });
    </script>
</body>
</html>
